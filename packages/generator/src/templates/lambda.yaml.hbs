# AWS Lambda deployment configuration (SAM template)
# Generated by Magic MCP for {{name}}
#
# Deploy with:
#   sam build
#   sam deploy --guided

AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: MCP Server - {{description}}

Globals:
  Function:
    Timeout: 30
    MemorySize: 512
    Runtime: nodejs20.x
    Architectures:
      - arm64
    Environment:
      Variables:
        NODE_ENV: production
        LOG_LEVEL: info

Resources:
  {{pascalCase name}}Function:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: .
      Handler: dist/index.handler
      Description: {{description}}
      {{#if hasAuth}}
      Environment:
        Variables:
          {{authEnvVar}}: !Ref ApiKeyParameter
      {{/if}}
      Events:
        HttpApi:
          Type: HttpApi
          Properties:
            Path: /{proxy+}
            Method: ANY
      Policies:
        - AWSLambdaBasicExecutionRole
    Metadata:
      BuildMethod: esbuild
      BuildProperties:
        Minify: true
        Target: es2022
        Sourcemap: false
        EntryPoints:
          - src/index.ts

  {{#if hasAuth}}
  ApiKeyParameter:
    Type: AWS::SSM::Parameter
    Properties:
      Name: /{{name}}/api-key
      Type: String
      Value: PLACEHOLDER_REPLACE_ME
      Description: API key for {{name}}
  {{/if}}

Outputs:
  {{pascalCase name}}Api:
    Description: API Gateway endpoint URL
    Value: !Sub "https://${ServerlessHttpApi}.execute-api.${AWS::Region}.amazonaws.com/"
  {{pascalCase name}}Function:
    Description: Lambda Function ARN
    Value: !GetAtt {{pascalCase name}}Function.Arn
  {{pascalCase name}}FunctionIamRole:
    Description: Implicit IAM Role created for function
    Value: !GetAtt {{pascalCase name}}FunctionRole.Arn
